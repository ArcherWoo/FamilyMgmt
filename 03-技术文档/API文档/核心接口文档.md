# 家庭生活管家小程序 - 核心接口文档

## 文档信息
- **文档版本**: V1.0
- **创建日期**: 2025-06-27
- **创建人**: AI Backend Developer
- **文档类型**: API接口文档
- **Base URL**: `https://api.familylife.com/v1`

---

## 1. 用户认证模块

### 1.1 微信登录
**接口**: `POST /auth/wechat-login`
**描述**: 通过微信授权码登录获取访问令牌

**请求参数**:
```json
{
  "code": "string",           // 微信授权码
  "encryptedData": "string",  // 加密用户信息(可选)
  "iv": "string"              // 初始向量(可选)
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "refresh_token_string",
    "expiresIn": 604800,
    "user": {
      "id": "user_123456",
      "openid": "wx_openid_123",
      "nickname": "张三",
      "avatar": "https://cdn.example.com/avatar.jpg",
      "gender": 1,
      "createdAt": "2025-06-27T10:30:00Z"
    }
  }
}
```

### 1.2 刷新Token
**接口**: `POST /auth/refresh-token`
**描述**: 使用刷新令牌获取新的访问令牌

**请求参数**:
```json
{
  "refreshToken": "string"
}
```

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "accessToken": "new_access_token",
    "expiresIn": 604800
  }
}
```

---

## 2. 家庭管理模块

### 2.1 创建家庭
**接口**: `POST /families`
**描述**: 创建新的家庭

**请求参数**:
```json
{
  "name": "string",          // 家庭名称，2-20字符
  "description": "string"    // 家庭描述(可选)
}
```

**响应示例**:
```json
{
  "code": 201,
  "message": "家庭创建成功",
  "data": {
    "id": "family_123456",
    "name": "幸福小家",
    "description": "我们的温馨家庭",
    "inviteCode": "123456",
    "inviteCodeExpiry": "2025-07-04T10:30:00Z",
    "createdBy": "user_123456",
    "createdAt": "2025-06-27T10:30:00Z",
    "memberCount": 1
  }
}
```

### 2.2 加入家庭
**接口**: `POST /families/join`
**描述**: 通过邀请码加入家庭

**请求参数**:
```json
{
  "inviteCode": "string"     // 6位数字邀请码
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "加入家庭成功",
  "data": {
    "family": {
      "id": "family_123456",
      "name": "幸福小家",
      "memberCount": 2
    },
    "member": {
      "id": "member_123456",
      "userId": "user_123456",
      "role": "member",
      "joinedAt": "2025-06-27T10:30:00Z"
    }
  }
}
```

### 2.3 获取家庭信息
**接口**: `GET /families/{familyId}`
**描述**: 获取家庭详细信息

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "id": "family_123456",
    "name": "幸福小家",
    "description": "我们的温馨家庭",
    "inviteCode": "123456",
    "members": [
      {
        "id": "member_123456",
        "user": {
          "id": "user_123456",
          "nickname": "张三",
          "avatar": "https://cdn.example.com/avatar.jpg"
        },
        "role": "admin",
        "joinedAt": "2025-06-27T10:30:00Z"
      }
    ],
    "createdAt": "2025-06-27T10:30:00Z"
  }
}
```

---

## 3. 饮食规划模块

### 3.1 创建餐食计划
**接口**: `POST /meals`
**描述**: 创建新的餐食计划

**请求参数**:
```json
{
  "familyId": "string",      // 家庭ID
  "date": "2025-06-27",      // 日期
  "mealType": "breakfast",   // 餐次类型: breakfast/lunch/dinner/snack
  "dishes": [
    {
      "name": "西红柿鸡蛋面",
      "description": "营养丰富的早餐",
      "cookingTime": 15,     // 制作时间(分钟)
      "difficulty": "easy",   // 难度: easy/medium/hard
      "ingredients": [
        {
          "name": "鸡蛋",
          "amount": "2个",
          "category": "蛋类"
        },
        {
          "name": "西红柿",
          "amount": "1个",
          "category": "蔬菜"
        }
      ],
      "nutrition": {
        "calories": 350,     // 卡路里
        "protein": 15.5,     // 蛋白质(g)
        "carbs": 45.2,       // 碳水化合物(g)
        "fat": 12.8          // 脂肪(g)
      },
      "images": [
        "https://cdn.example.com/dish1.jpg"
      ]
    }
  ],
  "assignedTo": "user_123456",  // 负责人
  "participants": [             // 参与人员
    "user_123456",
    "user_789012"
  ]
}
```

**响应示例**:
```json
{
  "code": 201,
  "message": "餐食计划创建成功",
  "data": {
    "id": "meal_123456",
    "familyId": "family_123456",
    "date": "2025-06-27",
    "mealType": "breakfast",
    "dishes": [...],
    "assignedTo": {
      "id": "user_123456",
      "nickname": "张三"
    },
    "participants": [...],
    "status": "planned",
    "createdAt": "2025-06-27T10:30:00Z"
  }
}
```

### 3.2 获取餐食计划列表
**接口**: `GET /meals`
**描述**: 获取家庭餐食计划列表

**查询参数**:
- `familyId`: 家庭ID
- `startDate`: 开始日期 (YYYY-MM-DD)
- `endDate`: 结束日期 (YYYY-MM-DD)
- `mealType`: 餐次类型
- `page`: 页码 (默认1)
- `pageSize`: 每页数量 (默认20)

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "items": [
      {
        "id": "meal_123456",
        "date": "2025-06-27",
        "mealType": "breakfast",
        "dishes": [...],
        "assignedTo": {...},
        "status": "completed"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 50,
      "totalPages": 3
    }
  }
}
```

### 3.3 生成购物清单
**接口**: `POST /shopping-lists/generate`
**描述**: 根据餐食计划生成购物清单

**请求参数**:
```json
{
  "familyId": "string",
  "startDate": "2025-06-27",
  "endDate": "2025-07-03",
  "mealIds": ["meal_123456", "meal_789012"]  // 可选，指定餐食计划
}
```

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "id": "shopping_list_123456",
    "familyId": "family_123456",
    "items": [
      {
        "ingredient": "鸡蛋",
        "totalAmount": "12个",
        "category": "蛋类",
        "purchased": false,
        "price": 0,
        "fromMeals": ["meal_123456", "meal_789012"]
      }
    ],
    "categories": [
      {
        "name": "蔬菜",
        "items": 5
      },
      {
        "name": "肉类",
        "items": 3
      }
    ],
    "createdAt": "2025-06-27T10:30:00Z"
  }
}
```

---

## 4. 运动健身模块

### 4.1 创建运动计划
**接口**: `POST /exercises`
**描述**: 创建新的运动计划

**请求参数**:
```json
{
  "familyId": "string",
  "name": "晨跑",
  "type": "cardio",           // 运动类型: cardio/strength/flexibility/sports
  "activity": "running",      // 具体活动
  "scheduledAt": "2025-06-27T06:30:00Z",
  "duration": 30,             // 持续时间(分钟)
  "intensity": "medium",      // 强度: low/medium/high
  "location": "小区公园",
  "participants": [
    "user_123456",
    "user_789012"
  ],
  "repeat": {
    "enabled": true,
    "pattern": "weekly",      // 重复模式: daily/weekly/monthly
    "daysOfWeek": [1, 3, 5],  // 周几重复 (1=周一)
    "endDate": "2025-12-31"
  },
  "goals": {
    "distance": 5,            // 距离(公里)
    "calories": 300           // 目标卡路里
  }
}
```

**响应示例**:
```json
{
  "code": 201,
  "data": {
    "id": "exercise_123456",
    "familyId": "family_123456",
    "name": "晨跑",
    "type": "cardio",
    "scheduledAt": "2025-06-27T06:30:00Z",
    "status": "scheduled",
    "participants": [...],
    "createdAt": "2025-06-27T10:30:00Z"
  }
}
```

### 4.2 运动打卡
**接口**: `POST /exercises/{exerciseId}/checkin`
**描述**: 记录运动完成情况

**请求参数**:
```json
{
  "completedAt": "2025-06-27T07:00:00Z",
  "actualDuration": 35,       // 实际时长(分钟)
  "actualDistance": 5.2,      // 实际距离(公里)
  "caloriesBurned": 320,      // 消耗卡路里
  "feeling": "great",         // 感受: terrible/bad/ok/good/great
  "notes": "今天状态很好，跑得比平时快",
  "images": [
    "https://cdn.example.com/exercise1.jpg"
  ],
  "location": {
    "latitude": 39.9042,
    "longitude": 116.4074,
    "address": "北京市朝阳区"
  }
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "打卡成功",
  "data": {
    "id": "checkin_123456",
    "exerciseId": "exercise_123456",
    "userId": "user_123456",
    "completedAt": "2025-06-27T07:00:00Z",
    "actualDuration": 35,
    "caloriesBurned": 320,
    "achievement": {
      "goalReached": true,
      "improvement": "+5分钟",
      "streak": 7              // 连续天数
    }
  }
}
```

---

## 5. 协作管理模块

### 5.1 创建任务
**接口**: `POST /tasks`
**描述**: 创建家庭任务

**请求参数**:
```json
{
  "familyId": "string",
  "title": "打扫客厅",
  "description": "周末大扫除",
  "category": "housework",    // 任务类别: housework/shopping/childcare/other
  "priority": "medium",       // 优先级: low/medium/high/urgent
  "assignedTo": "user_123456",
  "dueDate": "2025-06-28T18:00:00Z",
  "estimatedTime": 60,        // 预计时间(分钟)
  "repeat": {
    "enabled": true,
    "pattern": "weekly",
    "daysOfWeek": [6]         // 每周六
  },
  "checklist": [
    "扫地",
    "拖地",
    "整理物品"
  ]
}
```

**响应示例**:
```json
{
  "code": 201,
  "data": {
    "id": "task_123456",
    "familyId": "family_123456",
    "title": "打扫客厅",
    "status": "pending",
    "assignedTo": {...},
    "dueDate": "2025-06-28T18:00:00Z",
    "createdAt": "2025-06-27T10:30:00Z"
  }
}
```

### 5.2 更新任务状态
**接口**: `PATCH /tasks/{taskId}/status`
**描述**: 更新任务完成状态

**请求参数**:
```json
{
  "status": "completed",      // 状态: pending/in_progress/completed/cancelled
  "completedAt": "2025-06-27T16:30:00Z",
  "actualTime": 45,           // 实际用时(分钟)
  "notes": "比预期快完成了",
  "images": [
    "https://cdn.example.com/task_result.jpg"
  ],
  "checklist": [
    {
      "item": "扫地",
      "completed": true
    },
    {
      "item": "拖地", 
      "completed": true
    }
  ]
}
```

### 5.3 获取家庭动态
**接口**: `GET /families/{familyId}/activities`
**描述**: 获取家庭成员活动动态

**查询参数**:
- `type`: 活动类型 (meal/exercise/task/all)
- `limit`: 返回数量 (默认20)
- `offset`: 偏移量

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "activities": [
      {
        "id": "activity_123456",
        "type": "meal_completed",
        "user": {
          "id": "user_123456",
          "nickname": "张三"
        },
        "content": "完成了早餐制作",
        "relatedId": "meal_123456",
        "createdAt": "2025-06-27T08:30:00Z"
      },
      {
        "id": "activity_789012",
        "type": "exercise_checkin",
        "user": {
          "id": "user_789012",
          "nickname": "李四"
        },
        "content": "完成了晨跑打卡",
        "relatedId": "exercise_123456",
        "createdAt": "2025-06-27T07:00:00Z"
      }
    ]
  }
}
```

---

## 6. 数据统计模块

### 6.1 获取家庭统计数据
**接口**: `GET /families/{familyId}/statistics`
**描述**: 获取家庭生活统计数据

**查询参数**:
- `period`: 统计周期 (week/month/quarter/year)
- `startDate`: 开始日期
- `endDate`: 结束日期

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "period": "week",
    "startDate": "2025-06-21",
    "endDate": "2025-06-27",
    "meals": {
      "planned": 21,
      "completed": 18,
      "completionRate": 0.857
    },
    "exercises": {
      "planned": 10,
      "completed": 8,
      "totalDuration": 240,
      "totalCalories": 1200
    },
    "tasks": {
      "created": 15,
      "completed": 12,
      "completionRate": 0.8
    },
    "members": [
      {
        "userId": "user_123456",
        "nickname": "张三",
        "contributions": {
          "meals": 8,
          "exercises": 5,
          "tasks": 6
        }
      }
    ]
  }
}
```

---

## 7. 通用接口

### 7.1 文件上传
**接口**: `POST /upload`
**描述**: 上传文件到云存储

**请求**: `multipart/form-data`
- `file`: 文件内容
- `type`: 文件类型 (avatar/meal_image/exercise_image/task_image)

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "url": "https://cdn.example.com/uploads/2025/06/27/image_123456.jpg",
    "filename": "image_123456.jpg",
    "size": 1024000,
    "mimeType": "image/jpeg"
  }
}
```

### 7.2 获取系统配置
**接口**: `GET /config`
**描述**: 获取系统配置信息

**响应示例**:
```json
{
  "code": 200,
  "data": {
    "version": "1.0.0",
    "features": {
      "mealPlanning": true,
      "exerciseTracking": true,
      "taskManagement": true
    },
    "limits": {
      "familyMembers": 6,
      "fileUploadSize": 10485760,
      "dailyApiCalls": 1000
    }
  }
}
```

---

## 8. 错误码说明

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 1001 | 参数错误 | 检查请求参数格式和类型 |
| 1003 | 未授权 | 检查token是否有效 |
| 2001 | 用户不存在 | 确认用户ID是否正确 |
| 3001 | 家庭不存在 | 确认家庭ID是否正确 |
| 3003 | 邀请码无效 | 检查邀请码是否正确或已过期 |
| 4001 | 餐食计划不存在 | 确认餐食计划ID是否正确 |
| 5001 | 服务器内部错误 | 联系技术支持 |

---

## 9. 接口测试

### 9.1 测试环境
- **测试地址**: `https://api-test.familylife.com/v1`
- **测试账号**: 联系开发团队获取
- **Postman集合**: [下载链接]

### 9.2 测试用例
每个接口都应包含以下测试用例：
- 正常请求测试
- 参数错误测试
- 权限验证测试
- 边界值测试
- 并发请求测试
