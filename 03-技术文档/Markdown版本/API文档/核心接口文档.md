# å®¶åº­ç”Ÿæ´»AIåŠ©æ‰‹ - æ ¸å¿ƒæ¥å£æ–‡æ¡£ v6.0

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **ç‰ˆæœ¬**: v6.0 (A2A + MCPåŒå¼•æ“æ¶æ„)
- **æ›´æ–°æ—¥æœŸ**: 2025-06-28
- **åŸºäº**: A2A + MCPåŒå¼•æ“æ¶æ„v6.0
- **APIç‰ˆæœ¬**: v3
- **åŸºç¡€URL**: `https://api.familyai.com/v3`
- **åè®®æ”¯æŒ**: RESTful API + WebSocket + A2A Protocol + MCP Protocol
- **æ ¸å¿ƒç†å¿µ**: A2Aè´Ÿè´£Agenté—´åä½œï¼ŒMCPè´Ÿè´£å¤–éƒ¨æœåŠ¡é›†æˆ

## ğŸ” è®¤è¯æˆæƒ

### JWT Tokenè®¤è¯
æ‰€æœ‰APIè¯·æ±‚éœ€è¦åœ¨Headerä¸­æºå¸¦JWT Tokenï¼š
```
Authorization: Bearer {jwt_token}
```

### è·å–Token
```http
POST /auth/login
Content-Type: application/json

{
  "login_type": "wechat",
  "code": "wx_auth_code",
  "user_info": {
    "nickname": "ç”¨æˆ·æ˜µç§°",
    "avatar_url": "å¤´åƒURL"
  }
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "expires_in": 7200,
    "user": {
      "id": "uuid",
      "username": "ç”¨æˆ·å",
      "nickname": "æ˜µç§°",
      "avatar_url": "å¤´åƒURL"
    }
  }
}
```

## ğŸ”— A2A Agentåä½œæ¥å£

### è·å–å¯ç”¨Agentåˆ—è¡¨
```http
GET /a2a/agents
Authorization: Bearer {jwt_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "agents": [
      {
        "agent_id": "meal-planner-01",
        "agent_name": "é¥®é£Ÿè§„åˆ’Agent",
        "agent_type": "meal-planner",
        "status": "active",
        "capabilities": ["nutrition-analysis", "recipe-generation"],
        "endpoint": "http://meal-planner:8080"
      },
      {
        "agent_id": "exercise-coach-01",
        "agent_name": "è¿åŠ¨æ•™ç»ƒAgent",
        "agent_type": "exercise-coach",
        "status": "active",
        "capabilities": ["workout-planning", "health-monitoring"],
        "endpoint": "http://exercise-coach:8080"
      }
    ]
  }
}
```

### å‘èµ·Agentåä½œ
```http
POST /a2a/collaborate
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "session_id": "uuid",
  "initiator_agent": "meal-planner-01",
  "target_agent": "exercise-coach-01",
  "collaboration_type": "health_consultation",
  "request_data": {
    "user_id": "uuid",
    "meal_plan": {...},
    "health_goals": [...]
  }
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "åä½œè¯·æ±‚å‘é€æˆåŠŸ",
  "data": {
    "collaboration_id": "uuid",
    "status": "pending",
    "estimated_duration": "2-5ç§’"
  }
}
```

## ğŸŒ MCPæœåŠ¡æ¥å£

### è·å–å¯ç”¨MCPæœåŠ¡
```http
GET /mcp/services
Authorization: Bearer {jwt_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "services": [
      {
        "service_name": "nutrition-database",
        "version": "v1.0",
        "status": "healthy",
        "tools": ["search_food", "get_nutrition", "analyze_meal"],
        "endpoint": "http://nutrition-db:3001"
      },
      {
        "service_name": "weather-service",
        "version": "v1.0",
        "status": "healthy",
        "tools": ["get_current_weather", "get_forecast"],
        "endpoint": "http://weather-api:3002"
      }
    ]
  }
}
```

### è°ƒç”¨MCPæœåŠ¡å·¥å…·
```http
POST /mcp/call
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "service_name": "nutrition-database",
  "tool_name": "search_food",
  "parameters": {
    "query": "è‹¹æœ",
    "limit": 10
  },
  "cache_ttl": 3600
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "è°ƒç”¨æˆåŠŸ",
  "data": {
    "result": [
      {
        "fdc_id": 171688,
        "description": "è‹¹æœï¼Œç”Ÿçš„",
        "brand_owner": null,
        "data_type": "Foundation"
      }
    ],
    "cached": false,
    "duration_ms": 150
  }
}
```

## ğŸ¤– å¾®ä¿¡åŒæ¨¡å¼æœºå™¨äººæ¥å£

### æ¥æ”¶ç¾¤æ¶ˆæ¯
```http
POST /wechat/group/message
Content-Type: application/json
Authorization: Bearer {bot_token}

{
  "group_id": "group_uuid",
  "user_id": "user_uuid",
  "username": "å¼ ä¸‰",
  "message": "@AIåŠ©æ‰‹ ä»Šå¤©æƒ³åƒæ¸…æ·¡ä¸€ç‚¹çš„ï¼Œæœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ",
  "message_type": "text",
  "timestamp": "2025-06-28T10:00:00Z",
  "is_at_bot": true,
  "chat_mode": "group"
}
```

### æ¥æ”¶ç§èŠæ¶ˆæ¯
```http
POST /wechat/private/message
Content-Type: application/json
Authorization: Bearer {bot_token}

{
  "user_id": "user_uuid",
  "username": "å¼ ä¸‰",
  "message": "æˆ‘æœ€è¿‘æœ‰ç‚¹ä¾¿ç§˜ï¼Œä¸å¥½æ„æ€åœ¨ç¾¤é‡Œè¯´ï¼Œèƒ½ç»™æˆ‘ä¸€äº›å»ºè®®å—ï¼Ÿ",
  "message_type": "text",
  "timestamp": "2025-06-28T10:00:00Z",
  "chat_mode": "private",
  "privacy_level": "high"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æ¶ˆæ¯å¤„ç†æˆåŠŸ",
  "data": {
    "reply": "æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ¨èå‡ é“æ¸…æ·¡çš„èœå“...",
    "reply_type": "text",
    "should_reply": true
  }
}
```

### å‘é€ç¾¤æ¶ˆæ¯
```http
POST /wechat/group/send
Content-Type: application/json
Authorization: Bearer {bot_token}

{
  "group_id": "group_uuid",
  "message": "æé†’ï¼šä»Šå¤©æ˜¯å‘¨ä¸‰ï¼Œå»ºè®®å¤§å®¶å¤šåƒè”¬èœå“¦ï¼",
  "message_type": "text",
  "at_users": [],
  "chat_mode": "group"
}
```

### å‘é€ç§èŠæ¶ˆæ¯
```http
POST /wechat/private/send
Content-Type: application/json
Authorization: Bearer {bot_token}

{
  "user_id": "user_uuid",
  "message": "æ ¹æ®æ‚¨çš„æƒ…å†µï¼Œå»ºè®®å¤šåƒå¯Œå«çº¤ç»´çš„é£Ÿç‰©ï¼Œå¦‚ç‡•éº¦ã€è‹¹æœç­‰ã€‚è¿™äº›å»ºè®®ä»…ä¾›å‚è€ƒï¼Œå¦‚ç—‡çŠ¶æŒç»­è¯·å’¨è¯¢åŒ»ç”Ÿã€‚",
  "message_type": "text",
  "chat_mode": "private",
  "privacy_level": "high"
}
```

## ğŸ¤– AIå¯¹è¯æ¥å£

### å¤„ç†å¯¹è¯è¯·æ±‚
```http
POST /chat/process
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "session_id": "uuid",
  "message": "ä»Šå¤©æƒ³åƒæ¸…æ·¡ä¸€ç‚¹çš„ï¼Œæœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ",
  "context_type": "food",
  "group_id": "uuid",
  "user_info": {
    "user_id": "uuid",
    "username": "å¼ ä¸‰"
  }
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "message_id": "uuid",
    "session_id": "uuid",
    "response": {
      "content": "æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä¸ºæ‚¨æ¨èå‡ é“æ¸…æ·¡çš„èœå“...",
      "type": "text",
      "suggestions": [
        {
          "type": "recipe",
          "title": "è’¸è›‹ç¾¹",
          "description": "å«©æ»‘æ¸…é¦™ï¼Œè¥å…»ä¸°å¯Œ"
        }
      ]
    },
    "ai_model": "zhipu-glm4",
    "tokens_used": 150,
    "response_time": 2500
  }
}
```

### è·å–ä¼šè¯å†å²
```http
GET /chat/sessions/{session_id}/messages?page=1&limit=20
Authorization: Bearer {jwt_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "messages": [
      {
        "id": "uuid",
        "message_type": "user",
        "content": "ä»Šå¤©æƒ³åƒæ¸…æ·¡ä¸€ç‚¹çš„",
        "created_at": "2025-06-27T10:00:00Z"
      },
      {
        "id": "uuid",
        "message_type": "assistant",
        "content": "æˆ‘ä¸ºæ‚¨æ¨èå‡ é“æ¸…æ·¡èœå“...",
        "metadata": {
          "suggestions": []
        },
        "created_at": "2025-06-27T10:00:03Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 45,
      "has_more": true
    }
  }
}
```

## ğŸ½ï¸ é¥®é£Ÿè§„åˆ’æ¥å£

### åˆ›å»ºé¥®é£Ÿè®¡åˆ’
```http
POST /meal-plans
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "title": "æœ¬å‘¨å¥åº·é¥®é£Ÿè®¡åˆ’",
  "description": "ä½è„‚é«˜è›‹ç™½é¥®é£Ÿ",
  "plan_type": "weekly",
  "start_date": "2025-06-27",
  "end_date": "2025-07-03",
  "target_calories": 1800,
  "dietary_goals": ["å‡è„‚", "å¢è‚Œ"],
  "restrictions": ["æ— è¾£", "å°‘æ²¹"],
  "family_id": "uuid"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "uuid",
    "title": "æœ¬å‘¨å¥åº·é¥®é£Ÿè®¡åˆ’",
    "status": "active",
    "meals": [
      {
        "date": "2025-06-27",
        "breakfast": {
          "recipe_id": "uuid",
          "name": "ç‡•éº¦ç²¥é…æ°´æœ",
          "calories": 300
        },
        "lunch": {
          "recipe_id": "uuid",
          "name": "é¸¡èƒ¸è‚‰æ²™æ‹‰",
          "calories": 450
        },
        "dinner": {
          "recipe_id": "uuid",
          "name": "è’¸è›‹ç¾¹é…é’èœ",
          "calories": 350
        }
      }
    ],
    "created_at": "2025-06-27T10:00:00Z"
  }
}
```

### ç”Ÿæˆè´­ç‰©æ¸…å•
```http
POST /meal-plans/{plan_id}/shopping-list
Authorization: Bearer {jwt_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "ç”ŸæˆæˆåŠŸ",
  "data": {
    "id": "uuid",
    "title": "æœ¬å‘¨é‡‡è´­æ¸…å•",
    "items": [
      {
        "name": "é¸¡èƒ¸è‚‰",
        "quantity": "500g",
        "category": "è‚‰ç±»",
        "estimated_price": 25.00,
        "shops": [
          {
            "platform": "æ·˜å®",
            "price": 24.80,
            "url": "https://..."
          }
        ]
      }
    ],
    "total_amount": 156.80,
    "created_at": "2025-06-27T10:00:00Z"
  }
}
```

## ğŸƒ è¿åŠ¨æ¨èæ¥å£

### åˆ›å»ºè¿åŠ¨è®¡åˆ’
```http
POST /exercise-plans
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "title": "å‡è„‚å¡‘å½¢è®¡åˆ’",
  "fitness_goal": "å‡è„‚",
  "difficulty_level": 3,
  "duration_weeks": 4,
  "available_time": {
    "days_per_week": 3,
    "minutes_per_session": 45
  },
  "equipment": ["å“‘é“ƒ", "ç‘œä¼½å«"],
  "limitations": ["è†ç›–ä¸é€‚"]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "uuid",
    "title": "å‡è„‚å¡‘å½¢è®¡åˆ’",
    "exercises": [
      {
        "week": 1,
        "day": 1,
        "workout": {
          "warm_up": [
            {
              "name": "åŠ¨æ€æ‹‰ä¼¸",
              "duration": 5,
              "description": "å…¨èº«åŠ¨æ€æ‹‰ä¼¸åŠ¨ä½œ"
            }
          ],
          "main_workout": [
            {
              "name": "æ·±è¹²",
              "sets": 3,
              "reps": 15,
              "rest": 60,
              "description": "æ³¨æ„è†ç›–ä¸è¦è¶…è¿‡è„šå°–"
            }
          ],
          "cool_down": [
            {
              "name": "é™æ€æ‹‰ä¼¸",
              "duration": 10,
              "description": "è…¿éƒ¨å’Œè‡€éƒ¨æ‹‰ä¼¸"
            }
          ]
        }
      }
    ],
    "created_at": "2025-06-27T10:00:00Z"
  }
}
```

### è®°å½•è¿åŠ¨æ•°æ®
```http
POST /exercise-records
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "exercise_plan_id": "uuid",
  "exercise_type": "è·‘æ­¥",
  "duration_minutes": 30,
  "distance": 5.2,
  "calories_burned": 280,
  "heart_rate_avg": 145,
  "notes": "ä»Šå¤©çŠ¶æ€ä¸é”™",
  "exercise_date": "2025-06-27"
}
```

## ğŸ‘” ç©¿æ­å»ºè®®æ¥å£

### è·å–ç©¿æ­å»ºè®®
```http
POST /outfit/suggestions
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "date": "2025-06-27",
  "occasions": ["å·¥ä½œ", "å¥èº«"],
  "weather_location": "åŒ—äº¬å¸‚",
  "style_preferences": ["ç®€çº¦", "èˆ’é€‚"],
  "color_preferences": ["é»‘è‰²", "ç™½è‰²", "ç°è‰²"]
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "date": "2025-06-27",
    "weather": {
      "temperature": "15-22Â°C",
      "condition": "å¤šäº‘",
      "humidity": "60%",
      "wind": "å¾®é£"
    },
    "suggestions": [
      {
        "occasion": "å·¥ä½œ",
        "outfit": {
          "top": {
            "type": "è¡¬è¡«",
            "color": "ç™½è‰²",
            "description": "ç™½è‰²é•¿è¢–è¡¬è¡«"
          },
          "bottom": {
            "type": "è¥¿è£…è£¤",
            "color": "æ·±è“è‰²",
            "description": "æ·±è“è‰²è¥¿è£…è£¤"
          },
          "shoes": {
            "type": "çš®é‹",
            "color": "é»‘è‰²",
            "description": "é»‘è‰²å•†åŠ¡çš®é‹"
          },
          "accessories": ["è…°å¸¦", "æ‰‹è¡¨"]
        },
        "tips": "ä»Šå¤©æ¸©åº¦é€‚ä¸­ï¼Œå»ºè®®å†…æ­å¯ä»¥é€‰æ‹©è–„æ¬¾"
      }
    ]
  }
}
```

### è®°å½•ç©¿æ­
```http
POST /outfit/records
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "date": "2025-06-27",
  "occasion": "å·¥ä½œ",
  "outfit_items": [
    {
      "category": "ä¸Šè£…",
      "name": "ç™½è‰²è¡¬è¡«",
      "brand": "ä¼˜è¡£åº“",
      "color": "ç™½è‰²"
    }
  ],
  "satisfaction_rating": 4,
  "notes": "æ­é…æ•ˆæœä¸é”™",
  "image_urls": ["https://..."]
}
```

## ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­åä½œæ¥å£

### åˆ›å»ºå®¶åº­
```http
POST /families
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "name": "å¼ å®¶å¤§é™¢",
  "description": "æˆ‘ä»¬çš„æ¸©é¦¨å°å®¶",
  "settings": {
    "sharing_level": "full",
    "notification_enabled": true
  }
}
```

### é‚€è¯·å®¶åº­æˆå‘˜
```http
POST /families/{family_id}/invite
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "invite_method": "code",
  "role": "member",
  "message": "æ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„å®¶åº­"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "é‚€è¯·åˆ›å»ºæˆåŠŸ",
  "data": {
    "invite_code": "FAM123456",
    "expires_at": "2025-07-04T10:00:00Z",
    "invite_url": "https://app.familyai.com/join/FAM123456"
  }
}
```

### åŠ å…¥å®¶åº­
```http
POST /families/join
Content-Type: application/json
Authorization: Bearer {jwt_token}

{
  "invite_code": "FAM123456",
  "nickname": "å°æ˜"
}
```

## ğŸ“Š æ•°æ®ç»Ÿè®¡æ¥å£

### è·å–ç”¨æˆ·ç»Ÿè®¡
```http
GET /stats/user?period=week&start_date=2025-06-20&end_date=2025-06-27
Authorization: Bearer {jwt_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "period": "week",
    "nutrition": {
      "avg_calories": 1650,
      "protein_ratio": 0.25,
      "carb_ratio": 0.45,
      "fat_ratio": 0.30
    },
    "exercise": {
      "total_workouts": 3,
      "total_duration": 135,
      "avg_calories_burned": 320
    },
    "ai_usage": {
      "total_conversations": 12,
      "avg_response_time": 2.8,
      "satisfaction_rating": 4.2
    }
  }
}
```

## ğŸ”§ ç³»ç»Ÿæ¥å£

### å¥åº·æ£€æŸ¥
```http
GET /health
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "healthy",
  "timestamp": "2025-06-27T10:00:00Z",
  "services": {
    "database": "healthy",
    "redis": "healthy",
    "ai_service": "healthy",
    "mcp_gateway": "healthy"
  }
}
```

### è·å–ç³»ç»Ÿé…ç½®
```http
GET /config
Authorization: Bearer {jwt_token}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "data": {
    "ai_models": ["zhipu-glm4", "baidu-wenxin", "openai-gpt4"],
    "supported_features": ["food_planning", "exercise_recommendation", "outfit_suggestion"],
    "max_family_members": 8,
    "file_upload_limit": "10MB"
  }
}
```

## ğŸ“ é€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {},
  "timestamp": "2025-06-27T10:00:00Z"
}
```

### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯",
  "error": {
    "type": "ValidationError",
    "details": [
      {
        "field": "email",
        "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
      }
    ]
  },
  "timestamp": "2025-06-27T10:00:00Z"
}
```

### çŠ¶æ€ç è¯´æ˜
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ |
| 403 | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 429 | è¯·æ±‚é¢‘ç‡é™åˆ¶ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

*æœ¬APIæ–‡æ¡£å°†æ ¹æ®åŠŸèƒ½è¿­ä»£æŒç»­æ›´æ–°*
